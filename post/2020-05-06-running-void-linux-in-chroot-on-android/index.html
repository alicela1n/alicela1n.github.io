<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.108.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Running Void Linux in Chroot on Android&nbsp;&ndash;&nbsp;Alice's Digital Notebook</title><link rel=stylesheet href=../../css/core.min.a678a8fcd442e588a3ce898bbe660b06284fb8602630b560fbd95e9c1e45f45ca7ca327d2f4cdbb0d0a8da2f0ebf8084.css integrity=sha384-pnio/NRC5YijzomLvmYLBihPuGAmMLVg+9lenB5F9FynyjJ9L0zbsNCo2i8Ov4CE><meta name=twitter:card content="summary"><meta name=twitter:title content="Running Void Linux in Chroot on Android"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=../../><span class="site name">Alice's Digital Notebook</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=../../categories/>Categories</a><a class="nav item" href=../../tags/>Tags</a><a class="nav item" href=../../about/>About</a></nav></div></span></div><div class="site slogan"><span class=title>100% JavaScript-free</span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Running Void Linux in Chroot on Android</h1><p class="article date">May 06, 2020</p></section><article class="article markdown-body"><h1 id=introduction><strong>Introduction</strong></h1><p>So I decided to mess around with my Fire 7 tablet and see if I could get a chroot environment of Linux. I used Void because it is quite lightweight and is perfect for testing!
<img src=../../assets/void-chroot-on-android/IMG_20200506_140411.jpg alt="Amazon tablet"></p><h1 id=tutorial><strong>Tutorial</strong></h1><p>So first off this is what you will need:</p><ol><li>A rooted Android device</li><li>Linux</li><li>A reasonable amount of free space (at least 8GB)</li><li><a href=https://alpha.de.repo.voidlinux.org/live/current/ target=_blank rel="noopener noreferrer">Void Linux Root FS</a></li></ol><p>Now we can get started!</p><ul><li><p>Download these apps and install them to the device using adb</p><ul><li><a href=https://sourceforge.net/projects/libsdl-android/files/apk/XServer-XSDL/ target=_blank rel="noopener noreferrer">Xserver XSDL</a></li><li><a href=https://f-droid.org/en/packages/ru.meefik.busybox/ target=_blank rel="noopener noreferrer">Busybox</a></li><li><a href=https://f-droid.org/en/packages/com.termoneplus/ target=_blank rel="noopener noreferrer">Terminal Emulator</a></li></ul><pre tabindex=0><code>$ adb install XServer-XSDL-1.20.47.apk
$ adb install ru.meefik.busybox_46.apk
$ adb install com.termoneplus_334.apk
</code></pre></li><li><p>Create an image file to store Linux root fs on and push to device</p><pre tabindex=0><code>$ fallocate -l 5G linux.img
$ adb push linux.img /sdcard # Will take a long time
$ adb push void-armv7l-ROOTFS-20191109.tar.xz /sdcard
</code></pre></li><li><p>Start a shell on the device and gain root permissions</p><pre tabindex=0><code>$ adb shell
$ su
</code></pre></li><li><p>Create filesystem and mount loopback device</p><pre tabindex=0><code># mke2fs -t ext4 /sdcard/linux.img
# losetup /dev/block/loop7 linux.img
# mkdir /mnt/linux
# mount -t ext4 /dev/block/loop7 /mnt/linux
</code></pre></li><li><p>Extract root FS</p><pre tabindex=0><code># cp /storage/emulated/0/void-armv7l-ROOTFS-20191109.tar.xz /mnt/linux
# xzcat void-armv7l-ROOTFS-20191109.tar.xz | tar xvpf -
</code></pre></li><li><p>Chroot into it</p><pre tabindex=0><code># mount -t proc /proc /mnt/linux/proc 
# mount --rbind /sys /mnt/linux/sys
# mount --rbind /dev /mnt/linux/dev
# chroot /mnt/linux /bin/bash
# source /etc/profile
</code></pre></li><li><p>Create a resolv.conf and some networking groups</p><pre tabindex=0><code># cat &lt;&lt;EOF &gt; /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4
EOF
# groupadd -g 3001 aid_net_bt_admin
# groupadd -g 3002 aid_net_bt
# groupadd -g 3003 aid_inet
# groupadd -g 3004 aid_net_raw
# groupadd -g 3005 aid_net_admin
# groupadd -g 3006 aid_net_bw_stats
# groupadd -g 3007 aid_net_bw_acct
# groupadd -g 3008 aid_net_bt_stack
</code></pre></li><li><p>Create your user and configure the sudoers file</p><pre tabindex=0><code># useradd -m -G wheel,3001,3002,3003,3004,3005,3006,3007,3008 noritech
# visudo # Uncomment the %wheel line
# passwd noritech
</code></pre></li><li><p>Switch to user, install desktop environment and xorg packages</p><pre tabindex=0><code># su - noritech
# sudo xbps-install -Syu xorg xorg-server xauth xinit lxde xterm pulseaudio pavucontrol onboard

## If fails at:
[*] Updating repository `https://alpha.de.repo.voidlinux.org/current/armv7l-repodata&#39; ...
armv7l-repodata: 235KB [avg rate: -155KB/s]
libcrypto45-3.0.2_2 in transaction breaks installed pkg `libressl-2.9.2_1&#39;
libcrypto45-3.0.2_2 in transaction breaks installed pkg `libtls19-2.9.2_1&#39;
libssl47-3.0.2_2 in transaction breaks installed pkg `libressl-2.9.2_1&#39;
libssl47-3.0.2_2 in transaction breaks installed pkg `libtls19-2.9.2_1&#39;
Transaction aborted due to unresolved dependencies.

## Install these:
# sudo xbps-install libressl libtls19
</code></pre></li><li><p>Test the X server by starting it</p><pre tabindex=0><code># export DISPLAY=:0 PULSE_SERVER=tcp:127.0.0.1:4713
# exec startlxde
</code></pre></li><li><p>If that works you can create an init script to run in chroot that looks like this:</p><pre tabindex=0><code>#!/bin/bash
USER=&#34;noritech&#34;
source /etc/profile

# Switch over to user
su - ${USER} &lt;&lt; EOF
# Start X server
export DISPLAY=:0 PULSE_SERVER=tcp:127.0.0.1:4713
exec startlxde &amp;
EOF
</code></pre></li><li><p>Then start it with</p><pre tabindex=0><code>chroot /mnt/linux /bin/bash -l /init.sh
</code></pre></li><li><p>You can start your chroot with a script like this:</p><pre tabindex=0><code>#!/system/bin/sh

test -d &#34;/mnt/linux&#34; || {
  mkdir /mnt/linux
}

if ! mountpoint -q /mnt/linux; then
  losetup /dev/block/loop7 /sdcard/linux.img
  mount /dev/block/loop7 /mnt/linux
fi

if ! mountpoint -q /mnt/linux/dev; then
  mount -t proc /proc /mnt/linux/proc 
  mount --rbind /sys /mnt/linux/sys
  mount --rbind /dev /mnt/linux/dev
fi

chroot /mnt/linux /bin/bash -l /init.sh
</code></pre></li><li><p>Put chroot script in an executable place like <code>/data/local</code></p></li><li><p>Start chroot with the script after launching XServer XSDL</p><pre tabindex=0><code>$ su
# /data/local/chroot.sh
</code></pre></li></ul><h1 id=conclusion>Conclusion</h1><p>I may have missed something but I hope I didn&rsquo;t. I was bored and wanted to try creating a Void chroot on my Amazon Fire 7 tablet. Hopefully someone finds this helpful, let me know if there&rsquo;s anything I can improve.
<img src=../../assets/void-chroot-on-android/IMG_20200506_154835.jpg alt="LXDE running in Void"></p></article><section class="article author"><img class=avatar src="https://avatars.githubusercontent.com/u/18562602?v=4" alt><p class=name>alicela1n</p><div class=bio>Magical girl from another dimension.</div><div class=details><a class=item href=https://github.com/alicela1n target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;alicela1n</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=../../post/2020-05-14-taking-a-look-at-reactos/><span class="iconfont icon-article"></span>Taking a look at ReactOS, a real open source Windows XP replacement?</a></p><p><a class=link href=../../post/2020-04-10-aarch64-arch-linux-arm-on-raspberry-pi-4/><span class="iconfont icon-article"></span>AARCH64 Arch Linux ARM on Raspberry Pi 4</a></p></section></div></section><section id=footer><div style=display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between><p style=flex-shrink:0>Â©2022 alicela1n</p><a rel=me href=https://mastodon.online/@alicela1n>Mastodon</a><p><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section></body></html>